
<!-- multilingual suffix: en, es -->

<!-- [en] -->




<!-- [es] -->

# Creación de la máquina virtual
Para generar máquinas virtuales crearéis una cuenta personal de Azure a la que, posteriormente, le asignaréis vuestro email **@estudiant.upc.edu**. Una vez hecho esto deberéis activar una subscripción de Azure para estudiantes, con lo que tendréis acceso a algunos servicios de la plataforma, en los que podréis gastar 100 dólares que la plataforma os asignará gratuitamente. No es necesario que deis información de tarjetas bancarias ni realizar ningún gasto real para dar de alta el servicio en ningún momento del proceso.

A continuación, tenéis las páginas web donde poder daros de alta en los servicios.

- **Web UPC Azure.** Para dar de alta la cuenta, debe ser con un email personal, después podréis poner el email de la UPC. Deberéis autenticar la cuenta varias veces y poner vuestro número de teléfono para recibir los códigos de verificación. 

<https://serveistic.upc.edu/ca/distsoft/faq/microsoft-imagine/acord-upc-microsoft-imagine>

- **Web de Azure donde activar el servicio gratuito para estudiantes.** Existen dos promociones gratuitas, la común de 170€ durante un mes, y la versión de estudiantes, que proporciona 100€ durante 12 meses. Esta última es la que deberéis activar desde la siguiente página web. 

<https://azure.microsoft.com/es-es/free/students/>

Una vez realizado este proceso podréis acceder al portal de Azure en el botón “Portal” de la web de Microsoft Azure indicada primeramente o accediendo directamente a <https://portal.azure.com> , como se ve en las siguientes capturas de pantalla.
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.003.png) 
<!-- [es] -->
Una vez en el portal deberíais ver el siguiente web:
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.004.png)
<!-- [es] -->
Una vez dentro del portal debéis hacer clic en “Todos los servicios” y buscar “Education”, para verificar que tenéis disponibles los 100 USD en el inicio del proyecto y para consultar la cantidad restante a lo largo del mismo.
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.005.png)

![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.006.png)
<!-- [es] -->
Una vez hecho esto ya podéis poner en marcha vuestra máquina virtual, que será el principal elemento evaluable de vuestro proyecto que será tutorizado, pero no resuelto por el profesor. En caso de que tengáis dudas de operación con la plataforma deberéis primero buscar soluciones e información mediante los manuales profesionales de Azure. 

Para empezar a trabajar, deberéis entrar la página de inicio de Azure y buscar el botón Máquinas Virtuales. 
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.008.png)
<!-- [es] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.007.png)
Una vez allí podréis acceder al creador de máquinas virtuales. Más abajo tenéis las capturas de las características de la máquina que debéis generar. Como podéis comprobar, **NO se trata de la máquina más económica posible ya que emplearéis una máquina más potente para llevar a cabo la instalación inicial**. Os indicaremos a lo largo de la guía en qué momento podéis modificar las prestaciones de la máquina para que la arquitectura funcione sobre la máquina más económica, con un coste de 3,40€ al mes estando 24 horas activa. 

Vosotros las tendréis conectada mucho menos tiempo, por tanto, podríais optar por una máquina virtual con más prestaciones (¡cuidado, gastar los 100 USD de la cuenta implica el fin del acceso gratuito a los servicios, con impacto en la ejecución del proyecto!). Dado que la gestión económica y temporal es importante en cualquier implementación real, se os ruega que seáis cuidadosos.

A continuación, as capturas de pantalla muestran los pasos a realizar para generar la máquina virtual:

Paso 1 (Tipo de suscripción y tipo de máquina):
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.009.png)
<!-- [es] -->
Paso 2 (Método de acceso):
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.010.png)
<!-- [es] -->


Paso 3 (Reglas de puerto de entrada):
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.011.png)
<!-- [es] -->
Paso 4 (Opciones de disco):
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.012.png)
<!-- [es] -->


Paso 5 (Redes):
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.013.png)![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.014.png)
<!-- [es] -->
Paso 6 (Administración, apagado automático):
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.015.png)

![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.016.png)
<!-- [es] -->
Al hacer clic en “Revisar y crear”, deberéis esperar unos segundos y se os mostrará el siguiente mensaje:
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.017.png)
<!-- [es] -->
Finalmente, hacer clic en “Crear” y se os mostrará el siguiente mensaje:
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.018.png)
<!-- [es] -->
Hacer clic en “Descargar la clave privada y crear el recurso”. Una vez se haya creado el recurso se os mostrará el siguiente mensaje:
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.019.png)
<!-- [es] -->
**Deberéis almacenar el archivo de la clave privada en la siguiente ruta:**

***C:\Users\<UsuariodevuestroPC>\.ssh***

Si accedéis al recurso máquina virtual veréis que podéis iniciarla y detenerla. Además, para evitar sustos, en la configuración veréis que se os ha indicado que activéis el apagado automático de la máquina cada día a las 24:00:00, para que no haya problemas si se queda encendida después de trabajar en ella. 
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.020.png)
Podréis acceder a la siguiente página web para poder ver el saldo que os queda y el consumo que realizáis:

<https://www.microsoftazuresponsorships.com>

Os animamos en este punto a dedicar unos minutos a conocer la interfaz de Azure. Podéis intentar localizar la información de vuestra máquina virtual (IP pública, versión de sistema operativo, información acerca de CPU y discos). Debido a la riqueza de menús y opciones de la interfaz de Azure es imposible conocerla entera, pero creemos que es importante que dediquéis un poco de tiempo a localizar funciones importantes para trabajar con vuestra máquina virtual (iniciar, reiniciar, detener, eliminar) y podáis emplear dichas funciones a la hora de resolver problemas que vayan surgiendo a lo largo de la implementación del proyecto.
## Acceso a la máquina virtual mediante cliente SSH
Una vez arranquéis la maquina deberéis conectaros a ella para poder ejecutar comandos y utilizarla. Esta conexión se logra mediante SSH, un protocolo de línea de comandos que permite hacer algo parecido a programas de conexión remota de escritorios como TeamViewer. La máquina creada no tiene por qué tener una interfaz gráfica, es solo un ordenador con línea de comando, como es el caso que os ocupa.

En esta implementación, **accederéis a la máquina virtual mediante el par de claves SSH que ya habéis creado**, en lugar de utilizar usuario y contraseña. Este sistema minimiza las posibilidades que se reciba un ataque de intermediario (*man-in-the-middle attack*) a la hora de conectarse a la máquina virtual.

NOTA: Linux, Mac OSX y algunas versiones de Windows traen un cliente SSH instalado de fábrica, al que se puede acceder des del terminal de comandos (cmd para Windows). Si necesitáis instalarlo a parte, aquí tenéis un tutorial sencillo para Windows 10:

<https://www.profesionalreview.com/2018/11/30/ssh-windows-10/>

Para acceder a la máquina virtual mediante SSH hacer clic en el botón Conectar que podéis ver en la siguiente captura:
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.021.png)
<!-- [es] -->
Haced clic en *SSH* en el desplegable que se os abre, y llegaréis al siguiente menú:
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.022.png)
<!-- [es] -->
Ahora deberéis copiar la ruta de la clave privada que habéis descargado al crear la máquina virtual y pegarla en el espacio disponible en el punto 3. Una vez hecho esto, copiad el contenido del punto 4, ya que el comando se completará con la ruta de la clave privada que habéis indicado.



La respuesta del terminal debería ser parecida a la siguiente:
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.023.png)
<!-- [es] -->
En la parte inferior podéis ver que ya se indica el usuario y el nombre de vuestra máquina virtual. Por tanto, ya podréis ejecutar comandos sobre la máquina virtual a partir de esa línea.
## Habilitar acceso para el equipo docente
Se os proporcionará una clave pública que deberéis habilitar dentro de la máquina virtual.

Para hacerlo, copiad dicha clave pública y una vez dentro de la máquina virtual ejecutad los siguientes comandos para situaros en el directorio .ssh/:

      $ ls -a

      $ cd. ssh

El siguiente commando permite acceder al archivo que debéis configurar:

      $ sudo nano authorized\_keys
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.024.png)
<!-- [es] -->


El archivo *authorized\_keys* permite registrar las claves públicas que la máquina virtual considerará conocidas. Deberéis pegar en la línea inferior (marcada en rojo en la captura) a la que ya está escrita la clave pública que se os ha proporcionado:
<!-- [common] -->
![](../img/Aspose.Words.b1061091-e8de-4e39-91fb-4ba4b8e356ff.021.png)
<!-- [es] -->
Para salir guardad los cambios con CTRL+O, pulsad *Enter* para mantener el nombre del archivo guardado y salid con CTRL+X.

Finalmente podéis validar si hay dos claves registradas introduciendo el siguiente comando:

      $ sudo cat authorized\_keys
## Instrucciones de manejo de la máquina virtual
De cara al uso general del terminal Bash de Linux, podéis utilizar la siguiente web que os explicará los comandos básicos del terminal:

<https://es.wikibooks.org/wiki/Manual_de_consola_Bash_de_Linux>

Resaltar el uso de los siguientes comandos:

- “**cd**”. Permite desplazarse entre directorios.
- “**ps –A**”. Permite ver los procesos (programas) que está ejecutando el sistema operativo, muy útil para comprobar si el software que necesitareis está en ejecución.
- “**docker ps**”. Devuelve una lista con información de los contenedores generados (identificador, imagen a partir de la que se ha creado y estado).

Por otro lado, para los usuarios de Windows recomendamos instalar Windows Terminal, un programa que ofrece un terminal con muchas funcionalidades (navegar arriba y abajo para poder visualizar todos los comandos introducidos y la información devuelta por la máquina, generar varias sesiones de terminal en forma de pestañas en una misma ventana, …). Esta aplicación es gratuita y la podéis encontrar en la Microsoft Store.